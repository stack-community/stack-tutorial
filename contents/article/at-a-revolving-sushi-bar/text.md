---
title: 回転寿司屋で
next: fizzbuzz
---

Stack 電卓の扱いに慣れてきたところで、右下の枠に表示される　`Stack〔 ` ` 〕` の意味について説明しましょう。  
そもそも、このプログラミング言語の名前にもなっている Stack(スタック)って一体何なんでしょう？

スタックとはデータ構造の一種です。  
データ構造とは平たく言えば「データの保存のしかた」です。

スタックは元々「積み上げたもの」という意味です。  
回転寿司屋の積み上がった皿を想像してみてください。  
積み上がった皿の一番下から皿を取り出したり、真ん中に皿を追加しようとしたらどうなるでしょうか？  
皿が崩れて大変なことになってしまいますよね。  
寿司を堪能するのに専念したいなら、皿を取るのも載せるのも一番上からやるのが安全です。

データ構造のスタックも、取り出しと追加は一番上からしかできません。  
例えばスタックに 3, 9, 5 と順番に数字を追加したとして、最初に追加した 3 を取り出したいと思ったら、追加した時とは逆に 5, 9, 3 と取り出す必要があるわけです。

Stack プログラミング言語では、プログラム中に出てくるあらゆる値（数字とか文字列とか。この後にも色々やります）を一旦スタックに載せます。  
スタックから値を取り出して、それを計算して、またスタックに積み直して、それをまた取り出して・・・  
そんな処理を繰り返しながらプログラムを進めていきます。  
右下の枠に表示される　`Stack〔 ` ` 〕` は、計算途中のスタックの様子を表しています。

計算に逆ポーランド記法を使うのも、スタックと関係があります。  
逆ポーランド記法は、スタックを使った計算にとても都合が良いのです。  
(5+3)×(4-1) の計算を例に、スタックがどんな振る舞いをするのか見てみましょう。

(5+3)×(4-1) を逆ポーランド記法で書くと`5 3 add 4 1 sub mul`です(あらかじめ実行環境に書いておきました)。  
Stack プログラミング言語では、プログラムを前から順に見ていきます。  
スタックが積み上がった皿なら、プログラムはレーンを流れてくる皿のようなものです。  
目の前に流れてきた皿を手に取ったり取らなかったりするように、流れてきた値をスタックに積んだり計算をしたりするのです。

ではレーンに並んだ寿司ネタを見るような心持ちで、`5 3 add 4 1 sub mul`のプログラムを見てみましょう。
まず目の前にやってきたのは数字の 5 です。5 は値なのでひとまずスタックに積みます。

スタックには 5 が一つだけ載っています。

```
Stack〔 5 〕
```

次に来たのは 3 です。3 も値なのでスタックに積みます。  
二つ以上の値がスタックに乗っているときは、括弧の中に`|`で区切って書くことにします。  
括弧の中で左にあるものほど下にあることを意味します。

```
Stack〔 5 | 3 〕
```

今度は`add`が来ました。`add`はコマンドです。  
`add`の本当の意味は、「スタックのてっぺんから値を二つ取り出して、それらを足した結果をスタックに載せる」です。  
スタックのてっぺんから 3 と 5 を取り出して足します。結果の 8 をスタックに載せます。

```
Stack〔 8 〕
```

次は 4 です。4 は値なのでスタックに積みます。  
スタックには 2 つの値が載っています。

```
Stack〔 8 | 4 〕
```

その次は 1 が来ました。1 も値なのでスタックに載せます。  
3 つの値がスタックに載っている状態です。

```
Stack〔 8 | 4 | 1 〕
```

さて、`sub`のおでましです。  
`sub`の意味は`add`と似ていて、「スタックのてっぺんから値を二つ取り出して、二番目に取り出した値から一番目に取り出した値を引いた結果をスタックに載せる」です。  
スタックから 1 と 4 を取り出して、4 から 1 を引いた結果である 3 をスタックに積みます。

```
Stack〔 8 | 3 〕
```

最後に控えるのは`mul`です。かけ算のコマンドです。  
`mul`の本当の意味は、「スタックのてっぺんから値を二つ取り出して、それらをかけ合わせた結果をスタックに載せる」です。  
スタックから 3 と 8 を取り出して、3 かける 8、すなわち 24 をスタックに積みます。

```
Stack〔 24 〕
```

最後にスタックに残ったのが、プログラムの実行結果です。  
ということで、24 が計算の結果です。

それでは画面の右側にある実行環境でもプログラムを動かして、右下の枠を見てみましょう。  
今説明した通りの順番でスタックの中身が変わっていくことが分かるでしょう。  
こちらでは分かりやすいように、今まさに流れてくる値やコマンドが`← add`といった形で表されています。
